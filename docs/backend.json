{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the LensVivid application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "email",
        "displayName"
      ]
    },
    "PhotographyService": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PhotographyService",
      "type": "object",
      "description": "Represents a photography service offered by LensVivid.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the photography service."
        },
        "title": {
          "type": "string",
          "description": "Title of the photography service."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the service."
        },
        "price": {
          "type": "number",
          "description": "Price of the service."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to preview image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "price"
      ]
    },
    "PaymentCard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentCard",
      "type": "object",
      "description": "Represents payment card information for processing transactions.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment card."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N PaymentCard)"
        },
        "cardNumber": {
          "type": "string",
          "description": "The card number ( masked).",
          "format": "string"
        },
        "expirationDate": {
          "type": "string",
          "description": "Card expiration date.",
          "format": "string"
        },
        "cvv": {
          "type": "string",
          "description": "Card CVV (masked).",
          "format": "string"
        }
      },
      "required": [
        "id",
        "userId",
        "cardNumber",
        "expirationDate",
        "cvv"
      ]
    },
    "Purchase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Purchase",
      "type": "object",
      "description": "Represents a purchase made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the purchase."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Purchase)"
        },
        "serviceId": {
          "type": "string",
          "description": "Reference to PhotographyService. (Relationship: PhotographyService 1:N Purchase)"
        },
        "purchaseDate": {
          "type": "string",
          "description": "Date and time when the purchase was made.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount paid for the purchase."
        },
        "paymentCardId": {
          "type": "string",
          "description": "Reference to PaymentCard. (Relationship: PaymentCard 1:N Purchase)"
        }
      },
      "required": [
        "id",
        "userId",
        "serviceId",
        "purchaseDate",
        "amount"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profiles/{profileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Each user has their own profile document. Path-based ownership enforced for private data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "profileId",
              "description": "The unique identifier of the user profile."
            }
          ]
        }
      },
      {
        "path": "/photographyServices/{serviceId}",
        "definition": {
          "entityName": "PhotographyService",
          "schema": {
            "$ref": "#/backend/entities/PhotographyService"
          },
          "description": "Stores information about photography services offered. Accessible to all users.",
          "params": [
            {
              "name": "serviceId",
              "description": "The unique identifier of the photography service."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/paymentCards/{paymentCardId}",
        "definition": {
          "entityName": "PaymentCard",
          "schema": {
            "$ref": "#/backend/entities/PaymentCard"
          },
          "description": "Stores payment card information for each user. Path-based ownership to ensure only the user can access their payment cards.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "paymentCardId",
              "description": "The unique identifier of the payment card."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/purchases/{purchaseId}",
        "definition": {
          "entityName": "Purchase",
          "schema": {
            "$ref": "#/backend/entities/Purchase"
          },
          "description": "Stores purchase information for each user. Path-based ownership ensures that users can only access their own purchase history.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "purchaseId",
              "description": "The unique identifier of the purchase."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the LensVivid application, focusing on user profiles, photography services, payment cards, and purchase tracking. The structure prioritizes security, scalability, and ease of debugging by adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters).\n\n**Authorization Independence (CRITICAL):** Authorization is managed without hierarchical dependencies, avoiding `get()` calls in security rules. User-specific data is stored under the `/users/{userId}` path, ensuring clear ownership. This approach allows for atomic operations (transactions/batches) without relying on parent document data.\n\n**Structural Segregation (Homogeneous Security Posture):**  Each collection is designed with a specific security context. User profiles and payment cards are stored in user-specific subcollections (`/users/{userId}/profiles` and `/users/{userId}/paymentCards`) to ensure only the authenticated user can access their own data. Photography services are stored in a global collection (`/photographyServices`) as these are intended to be publicly accessible for browsing.\n\n**Access Modeling (Standardization and Consistency):** Path-based ownership (`/users/{userId}/profiles`) is used for private user data.  The 1:N relationship between users and their payment cards and purchases are modeled using hierarchical paths (`/users/{userId}/paymentCards/{paymentCardId}` and `/users/{userId}/purchases/{purchaseId}`). This approach provides clear ownership and simplifies security rules.\n\n**QAPs (Rules are not Filters):**\n*   The segregation of photography services into a separate collection (`/photographyServices`) allows for secure listing of all available services without exposing any private data.\n*   User-owned payment cards and purchases are stored in user-specific subcollections, ensuring that users can only list and access their own data."
  }
}